<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0"/ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clover</title>
    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>

    <link rel="stylesheet" type="text/css" href="/css/join.css">

    <!-- jQuery (부트스트랩의 자바스크립트 플러그인을 위해 필요한) -->
    <script src="http://code.jquery.com/jquery.js"></script>
    <!-- 모든 합쳐진 플러그인을 포함하거나 (아래) 필요한 각각의 파일들을 포함하세요 -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- Respond.js 으로 IE8 에서 반응형 기능을 활성화하세요 (https://github.com/scottjehl/Respond) -->
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

    <link rel="stylesheet" href="/css/bootstrap.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.js"></script>
</head>
<body>
<th:block th:include="include/navbar"> </th:block>
<div class="container"><!-- 좌우측의 공간 확보 -->
    <!-- 헤더 들어가는 부분 -->

<!--    <div class="row">-->
<!--        <p></p>-->
<!--        <div class="col-md-12">-->
<!--            <small>-->
<!--                <a href="#">로그인</a> | <a href="#">회원가입</a>-->
<!--            </small>-->
<!--        </div>-->
<!--    </div>-->
    <!--// 헤더 들어가는 부분 -->
    <!-- 모달창 -->
    <div class="modal fade" id="defaultModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">알림</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body">
                    <p class="modal-contents"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!--// 모달창 -->
    <hr/>
    <!-- 본문 들어가는 부분 -->



    <form class="form-horizontal" role="form" method="post" action="sign" >
        <div class="form-group" id="divId">
            <label  class="col-lg-2 control-label">아이디</label>
            <div class="col-lg-10">
                <input type="text" name="userId" class="id_input form-control onlyAlphabetAndNumber" id="id" data-rule-required="true" placeholder="30자이내의 알파벳, 언더스코어(_), 숫자만 입력 가능합니다." maxlength="30">
            </div>
            <span class="err iderr">아이디를 입력해주세요</span>
            <span class="id_input_re1">사용 가능한 아이디 입니다.</span>
            <span class="id_input_re2">이미 사용중인 아이디입니다.</span>
        </div>

        <div class="form-group" id="divPassword">
            <label  class="col-lg-2 control-label">패스워드</label>
            <div class="col-lg-10">
                <input type="password" name="pwd" class="form-control" id="password"  data-rule-required="true" placeholder="패스워드" maxlength="30">
            </div>
            <span class="err pwerr">비밀번호를 입력해주세요</span>
        </div>

        <div class="form-group" id="divPasswordCheck">
            <label  class="col-lg-2 control-label">패스워드 확인</label>
            <div class="col-lg-10">
                <input type="password" class="form-control" id="passwordCheck" data-rule-required="true" placeholder="패스워드 확인" maxlength="30">
            </div>
            <span class="err chkerr">비밀번호가 일치하지 않습니다.</span>
        </div>
        <div class="form-group" id="divName">
            <label class="col-lg-2 control-label">이름</label>
            <div class="col-lg-10">
                <input type="text"name="name" class="form-control onlyHangul" id="name" data-rule-required="true" placeholder="한글만 입력 가능합니다." maxlength="15"/>
            </div>
            <span class="err nameerr">이름를 입력해주세요</span>
        </div>

        <div class="form-group" id="divNickname">
            <label  class="col-lg-2 control-label">닉네임</label>
            <div class="col-lg-10">
                <input type="text" name="nickname" class="form-control" id="nickname" data-rule-required="true" placeholder="별명" maxlength="15">
            </div>
            <span class="err nicknameerr">닉네임을 입력해주세요</span>
        </div>

        <div class="form-group" id="divEmail">
            <label class="col-lg-2 control-label">이메일</label>
            <div class="col-lg-10">
                <input type="email" name="email" class="emailchk form-control" id="email" data-rule-required="true" placeholder="이메일" maxlength="40">
               <input type="text" class="elchk" placeholder="인증키 입력"> <input type="button" class="elchk_2" onclick="emailchk();" value="이메일 인증"/><input type="button" onclick="chaking()" class="elchk" value="인증확인">
                <span class="echeking">이미 사용중인 이메일입니다.</span><span class="echking_2">인증이 완료되었습니다.</span>
            </div>
            <span class="err emailerr">이메일를 입력해주세요</span>
        </div>


        <div class="form-group" id="divPhoneNumber">
            <label  class="col-lg-2 control-label">휴대폰 번호</label>
            <div class="col-lg-10">
                <input type="tel" name="phone" class="form-control onlyNumber" id="phoneNumber" data-rule-required="true" placeholder="-를 제외하고 숫자만 입력하세요." maxlength="11">
            </div>
            <span class="err phoneerr">연락처를 입력해주세요</span>
        </div>
        <div class="form-group">
            <label  class="col-lg-2 control-label">성별</label>
            <div class="col-lg-10">
                <select name="sex" class="form-control" id="gender">
                    <option value=1>남</option>
                    <option value=2>여</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <div class="col-lg-offset-2 col-lg-10">
                <button type="submit" class="btn btn-primary">Sign in</button>
            </div>
        </div>
    </form>


    <script>
        var idchk;
        var modalContents = $(".modal-contents");
        var modal = $("#defaultModal");
        $(function(){
            //모달을 전역변수로 선언
            $('.onlyAlphabetAndNumber').keyup(function(event){
                if (!(event.keyCode >=37 && event.keyCode<=40)) {
                    var inputVal = $(this).val();
                    $(this).val($(this).val().replace(/[^_a-z0-9]/gi,'')); //_(underscore), 영어, 숫자만 가능
                }
            });

            $(".onlyHangul").keyup(function(event){
                if (!(event.keyCode >=37 && event.keyCode<=40)) {
                    var inputVal = $(this).val();
                    $(this).val(inputVal.replace(/[a-z0-9]/gi,''));
                }
            });

            $(".onlyNumber").keyup(function(event){
                if (!(event.keyCode >=37 && event.keyCode<=40)) {
                    var inputVal = $(this).val();
                    $(this).val(inputVal.replace(/[^0-9]/gi,''));
                }
            });

            //------- 검사하여 상태를 class에 적용
            $('#id').keyup(function(event){

                var divId = $('#divId');

                if($('#id').val()==""){
                    $("#userid").css("border-color","#ff4d78");
                    $(".iderr").show();
                    divId.removeClass("has-success");
                    divId.addClass("has-error");
                }else{
                    $("#userid").css("border-color","#dddddd");
                    $(".iderr").hide();
                    divId.removeClass("has-error");
                    divId.addClass("has-success");
                }
            });

            $('#password').keyup(function(event){

                var divPassword = $('#divPassword');
                $("#passwordCheck").val("");
                if($('#password').val()==""){
                    divPassword.removeClass("has-success");
                    divPassword.addClass("has-error");
                    $("#password").css("border-color","#ff4d78");
                    $(".pwerr").show();
                }else{
                    divPassword.removeClass("has-error");
                    divPassword.addClass("has-success");
                    $("#password").css("border-color","#dddddd");
                    $(".pwerr").hide();
                }
            });

            $('#passwordCheck').keyup(function(event){

                var passwordCheck = $('#passwordCheck').val();
                var password = $('#password').val();
                var divPasswordCheck = $('#divPasswordCheck');

                if((passwordCheck=="") || (password!=passwordCheck)){
                    divPasswordCheck.removeClass("has-success");
                    divPasswordCheck.addClass("has-error");
                    $("#passwordCheck").css("border-color","#ff4d78");
                    $(".chkerr").show();
                }else{
                    divPasswordCheck.removeClass("has-error");
                    divPasswordCheck.addClass("has-success");
                    $("#passwordCheck").css("border-color","#dddddd");
                    $(".chkerr").hide();
                }
            });

            $('#name').keyup(function(event){

                var divName = $('#divName');

                if($.trim($('#name').val())==""){
                    divName.removeClass("has-success");
                    divName.addClass("has-error");
                    $("#name").css("border-color", "#ff4d78");
                    $(".nameerr").show();
                }else{
                    divName.removeClass("has-error");
                    divName.addClass("has-success");
                    $("#name").css("border-color", "#dddddd");
                    $(".nameerr").hide();
                }
            });

            $('#nickname').keyup(function(event){

                var divNickname = $('#divNickname');

                if($.trim($('#nickname').val())==""){
                    divNickname.removeClass("has-success");
                    divNickname.addClass("has-error");
                    $("#nickname").css("border-color", "#ff4d78");
                    $(".nicknameerr").show();
                }else{
                    divNickname.removeClass("has-error");
                    divNickname.addClass("has-success");
                    $("#nickname").css("border-color", "#dddddd");
                    $(".nicknameerr").hide();
                }
            });

            $('#email').keyup(function(event){

                var divEmail = $('#divEmail');

                if($.trim($('#email').val())==""){
                    divEmail.removeClass("has-success");
                    divEmail.addClass("has-error");
                    $("#email").css("border-color","#ff4d78");
                    $(".emailerr").show();
                }else{
                    divEmail.removeClass("has-error");
                    divEmail.addClass("has-success");
                    $("#email").css("border-color","#dddddd");
                    $(".emailerr").hide();
                }
            });

            $('#phoneNumber').keyup(function(event){

                var divPhoneNumber = $('#divPhoneNumber');

                if($.trim($('#phoneNumber').val())==""){
                    divPhoneNumber.removeClass("has-success");
                    divPhoneNumber.addClass("has-error");
                    $("#phoneNumber").css("border-color", "#ff4d78");
                    $(".phoneerr").show();
                }else{
                    divPhoneNumber.removeClass("has-error");
                    divPhoneNumber.addClass("has-success");
                    $("#phoneNumber").css("border-color", "#dddddd");
                    $(".phoneerr").hide();
                }
            });


            //------- validation 검사
            $( "form" ).submit(function( event ) {

                var divId = $('#divId');
                var divPassword = $('#divPassword');
                var divPasswordCheck = $('#divPasswordCheck');
                var divName = $('#divName');
                var divNickname = $('#divNickname');
                var divEmail = $('#divEmail');
                var divPhoneNumber = $('#divPhoneNumber');


                //아이디 검사
                if($('#id').val()==""){
                    modalContents.text("아이디를 입력하여 주시기 바랍니다.");
                    modal.modal('show');

                    divId.removeClass("has-success");
                    divId.addClass("has-error");
                    $('#id').focus();
                    return false;
                }else{
                    divId.removeClass("has-error");
                    divId.addClass("has-success");
                }
                //아이디 중복검사
                if(idchk=='fail'){
                    //console.log("아디중복"+idchk);
                    modalContents.text("중복되는 아이디입니다.");
                    modal.modal('show');

                    divId.removeClass("has-success");
                    divId.addClass("has-error");
                    $('#id').focus();
                    return false;
                }else{
                   // console.log("아디중복2"+idchk);
                    divId.removeClass("has-error");
                    divId.addClass("has-success");
                }

                //패스워드 검사
                if($('#password').val()==""){
                    modalContents.text("패스워드를 입력하여 주시기 바랍니다.");
                    modal.modal('show');
                    divPassword.removeClass("has-success");
                    divPassword.addClass("has-error");
                    $('#password').focus();
                    return false;
                }else{
                    divPassword.removeClass("has-error");
                    divPassword.addClass("has-success");
                }

                //패스워드 확인
                if($('#passwordCheck').val()==""){
                    modalContents.text("패스워드 확인을 입력하여 주시기 바랍니다.");
                    modal.modal('show');

                    divPasswordCheck.removeClass("has-success");
                    divPasswordCheck.addClass("has-error");
                    $('#passwordCheck').focus();
                    return false;
                }else{
                    divPasswordCheck.removeClass("has-error");
                    divPasswordCheck.addClass("has-success");
                }

                //패스워드 비교
                if($('#password').val()!=$('#passwordCheck').val() || $('#passwordCheck').val()==""){
                    modalContents.text("패스워드가 일치하지 않습니다.");
                    modal.modal('show');

                    divPasswordCheck.removeClass("has-success");
                    divPasswordCheck.addClass("has-error");
                    $('#passwordCheck').focus();
                    return false;
                }else{
                    divPasswordCheck.removeClass("has-error");
                    divPasswordCheck.addClass("has-success");
                }

                //이름
                if($('#name').val()==""){
                    modalContents.text("이름을 입력하여 주시기 바랍니다.");
                    modal.modal('show');

                    divName.removeClass("has-success");
                    divName.addClass("has-error");
                    $('#name').focus();
                    return false;
                }else{
                    divName.removeClass("has-error");
                    divName.addClass("has-success");
                }

                //별명
                if($('#nickname').val()==""){
                    modalContents.text("별명을 입력하여 주시기 바랍니다.");
                    modal.modal('show');

                    divNickname.removeClass("has-success");
                    divNickname.addClass("has-error");
                    $('#nickname').focus();
                    return false;
                }else{
                    divNickname.removeClass("has-error");
                    divNickname.addClass("has-success");
                }

                //이메일
                if($('#email').val()==""){
                    modalContents.text("이메일을 입력하여 주시기 바랍니다.");
                    modal.modal('show');

                    divEmail.removeClass("has-success");
                    divEmail.addClass("has-error");
                    $('#email').focus();
                    return false;
                }else{
                    divEmail.removeClass("has-error");
                    divEmail.addClass("has-success");
                }

                //휴대폰 번호
                if($('#phoneNumber').val()==""){
                    modalContents.text("휴대폰 번호를 입력하여 주시기 바랍니다.");
                    modal.modal('show');

                    divPhoneNumber.removeClass("has-success");
                    divPhoneNumber.addClass("has-error");
                    $('#phoneNumber').focus();
                    return false;
                }else{
                    divPhoneNumber.removeClass("has-error");
                    divPhoneNumber.addClass("has-success");
                }


            });

        });

        var emailcheking;
        //이메일 인증
        function emailchk(){
            var email = $('.emailchk').val();//이메일 입려된값
            var data = {email:email,
                        bool:false}
            $.ajax({
                type: "post",
                url: "/mailchk",
                data,
                success : function (result){
                    console.log(result);
                    if(result=='success'&& $('.emailchk').val()!=""){
                        $('.elchk').css("display","inline-block")
                        $('.elchk_2').css("display","none")
                        $('.echeking').css("display","none")
                            $.ajax({
                                type:"post",
                                url:"/mail",
                                data,
                                success : function (code){
                                    emailcheking=code;
                                }
                            })

                    }else{
                        $('.elchk_2').css("display","inline-block")
                        $('.echeking').css("display","inline-block")
                        $('.elchk').css("display","none")

                    }
                }
            })
        }

        //이메일 코드 체킹
        function chaking(event) {
            var code = $('.elchk').val();//인증키 입력란 값
            console.log("인증확인");
            console.log(code+"값");
            console.log(emailcheking+"값");
            if ($('.elchk').val() == "") {
                console.log("빈란");
                modalContents.text("인증코드를 입력하여 주시기 바랍니다.");
                modal.modal('show');
            } else if ($('.elchk').val() != emailcheking || emailcheking == "") {
                console.log("코드오류");
                modalContents.text("잘못된 코드 입니다.");
                modal.modal('show');
                return false;
            } else if($('.elchk').val()==emailcheking){
                console.log("인증완");
                $('.elchk').css("display","none");
                $('.echking_2').css("display","inline-block");

            }
        }

        //아이디 중복검사
        $('.id_input').on("propertychange change keyup paste input", function () {
         /*  console.log("keyup 테스트");*/
            var userId = $('.id_input').val(); //.id_input에 입력되는 값
            var data = {userId : userId} //'컨트롤에 넘길 데이터 이름' :'데이터(.id_input에 입력 되는 값)'

            console.log("ajax");
            $.ajax({

                type :"post",
                url : "/memberIdChk",
                data:data,
                success : function (result){
                    console.log(result);
                    if(result == 'success'){
                        $('.id_input_re1').css("display","inline-block");
                        $('.id_input_re2').css("display","none");
                        idchk='success';
                        console.log("1성공여부"+result);
                    }else if(result=='fail'){
                        $('.id_input_re2').css("display","inline-block");
                        $('.id_input_re1').css("display","none");
                        idchk='fail';
                        console.log("2성공여부"+result);
                    }else{
                        $('.id_input_re2').css("display","none");
                        $('.id_input_re1').css("display","none");
                        console.log("3성공여부"+result);
                    }
                }
            });
        });

    </script>
    <!--// 본문 들어가는 부분 -->
    <hr/>
    <!-- 푸터 들어가는 부분 -->

<!--    <div>-->
<!--        <p class="text-center">-->
<!--            <small><strong>업체명</strong></small><br>-->
<!--            <small>대표 : 홍길동 ㆍ 주소 :  사거리 ㆍ 사업자등록번호:123-12-12345 ㆍ 전화 : 02-123-1234</small><br>-->
<!--            <small>Copyrightⓒ test.com All rights reserved.</small>-->
<!--        </p>-->
<!--    </div>-->
    <!--// 푸터 들어가는 부분 -->
</div>
</body>
</html>